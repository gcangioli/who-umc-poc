<div xmlns="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://hl7.org/fhir ../../input-cache/schemas/R5/fhir-single.xsd">
  <h3>Substance Request</h3>
    <p>
        Here it is described how the WHO-UMC IDMP API is used to request a new SubstanceDefinitions representing a GSID in an asynchronous way. 
    </p>
    <p>
        The reason we need an asynchronous request model is that generating the GSID might take long time since it normaly will require human interaction.
    </p>
    <p>
        The input for the request is defined as a draft SubstanceDefinition resource without an Identifier.
    </p>
    <p>
        Upon a successful request, a GSID is generated and a new SubstanceDefinition resource representing it will be available.    
    </p>
  <h3>Workflow</h3>
	<p>
        <ol>
        <li> Create a 'draft' SubstanceDefinition (SD) resource with the information available for GSID generation. The resource should only have an id for internal references in the task and no Identifier since it is the Identifier (the GSID) that will be generated.</li>
        <li> Place the SD resource in the contained section of a Task resource.</li>
        <li> POST the Task to the maintenance organization. Before POSTing the Task it should be valideted using a $validate call</li>            
        <li> GET the status of the Task by using the 'ContentLocation' header returned from the POST call.</li>
        <li> When finished the GET call will display status 'completed' and the body of the get will contain the Task with the generated SubstanceDefinition resource (including a GSID) in the output section.</li>
        <li> The generated SubstanceDefinition will be available as a resolvable url.</li>
        </ol>
	</p>
	<p>
		<img height="300" src="SubstanceRequestWF.png" alt="A sample image"/>
	</p>
</div>
